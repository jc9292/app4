<html>
<head>
        <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        <link href="css/style.css" type="text/css" rel="stylesheet" />
        <script type="text/javascript" src="js/jquery-1.10.2.min.js"></script>
        <script type="text/javascript" src="js/iscroll-probe.js"></script> <!-- pour le scrolling vertical + le pull on refresh -->
        <style>
        	body{margin:0px;}
a.msel { font-weight:bold; }
#hello, #hello section{width:100%; height:600px;}

#hello section{position: absolute;left:100%; -webkit-user-select:none; }

#hello{position: relative; overflow: hidden;}

#hello section:nth-child(1){background: orange; left:0%;}
#hello section:nth-child(2){background: lightblue;}
#hello section:nth-child(3){background: pink;}
#hello section:nth-child(4){background: lightgreen;}
#wrapper, #wrapper2 {
  position:absolute; z-index:1;
  top:0px; bottom:48px; left:0;
  width:100%; height:400px;
  background:#aaa;
  overflow:hidden;
}
#scroller, #scroller2 {
  position:absolute; z-index:1;
  -webkit-tap-highlight-color:rgba(0,0,0,0);
  width:100%;
  padding:0;
}
        </style>
</head>
<body>
<div style="position:relative;height:40px;width:100%">
<div style="z-index:10;position:fixed;background:#fff;height:40px;width:100%;" id="m1">
<a data-section="1" id="ml1" class="msel" href="#">ORANGE</a>
<a data-section="2" id="ml2" href="#">BLUE</a>
<a data-section="3" id="ml3" href="#">PINK</a>
<a data-section="4" id="ml4" href="#">GREEN</a>
<b id=log></b>
    </div></div>
<div id="hello">
    <section id="pg1" class="active">
        <div id="wrapper"> 
	        <div id="scroller">
        gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<a href="#" id=t2>lien</a><br>
                gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>gfg11 f gfh sdg dsgf hgdfh ghdsg hfgsdhfgdhf ghdshfd gsds ds s fj sjhd gfgf<br>
            </div></div>
    </section>
    <section id="pg2">
        <div id="wrapper2">
	    <div id="scroller2">
		  <ul id=ul1>
            </ul>
            </div></div>    
    </section>
    <section id="pg3">gfgfgfgf</section>
    <section id="pg4">gfgfgfgf</section>
</div>
<script>
	$(function() {
    function abso() {
        $('#hello section').css({
            height: $(window).height()-40
        });
    }
    $(window).resize(function() {
        abso();         
    });
    abso();
});

var pgCid=1;
$('#m1 a').on('click', function(event) {
    event.preventDefault();
    var pgToid = parseInt($(this).attr("data-section")),
    $toSlide= $("#hello section#pg"+pgToid),
    $fromSlide= $("#hello section#pg"+pgCid);
    if (pgToid>pgCid) {
        $toSlide.css("left","100%");
        $fromSlide.animate({"left":"-100%"},500,'linear')
        $toSlide.animate({"left":"0%"},500,'linear',function() {    
              $fromSlide.css("left","100%");
        });
    } else if (pgToid<pgCid) {
        $toSlide.css("left","-100%");
        $fromSlide.animate({"left":"100%"},500,'linear')
        $toSlide.animate({"left":"0%"},500,'linear',function() {    
              $fromSlide.css("left","-100%");
        });
    } else { return false; }
    $('#m1 #ml'+pgCid).removeClass("msel");
    $('#m1 #ml'+pgToid).addClass("msel");
    pgCid=pgToid;
});
$('#t2').on('click',function() { alert('ok'); });

var pos1=0; var posy1=0;
$('section').on('mousedown', function(e) {
       pos1=e.pageX;
       posy1=e.pageY;
       var pos2=parseInt($(document).width());
       var start1=0;
       var bloq1=0;
       $(window).on('mousemove',function(e) {
       		$('#log').html(pos1+' '+pos2+' '+e.pageX+' '+(e.pageX-pos1)+' start='+start1+' pgCid='+pgCid);
           console.log(pos1+' '+pos2+' '+e.pageX+' '+(e.pageX-pos1)+' start='+start1+' pgCid='+pgCid);
           if ((Math.abs(e.pageX-pos1)>10) && (Math.abs(e.pageY-posy1)>Math.abs(e.pageX-pos1))) {
               bloq1=1;
           }
           if ((pos1!=0)&&(bloq1==0)) {
                if ((e.pageX-pos1)<-10) {
                    if (pgCid==4) {
                        $('#pg'+pgCid).css('left',(e.pageX-pos1)+'px');
                    } else {
                       // $('#pg'+pgCid).css('left',(e.pageX-pos1)+'px');
                       if (start1==0) {
                          $('#pg'+(pgCid+1)).css('z-index',99);
                          $('#pg'+(pgCid+1)).css('box-shadow','-10px 0 30px #000');
                          start1=1;
                       }
                       $('#pg'+(pgCid+1)).css('left',(pos2+e.pageX-pos1)+'px');
                    }
                } else if ((e.pageX-pos1)>10) {
                    if (pgCid==1) {
                        $('#pg'+pgCid).css('left',(e.pageX-pos1)+'px');
                    } else {
                        // $('#pg'+pgCid).css('left',(e.pageX-pos1)+'px');
                        if (start1==0) {
                            $('#pg'+(pgCid-1)).css('z-index',99);
                            $('#pg'+(pgCid-1)).css('box-shadow','10px 0 30px #000');
                            start1=1;
                        }
                        $('#pg'+(pgCid-1)).css('left',(-pos2+e.pageX-pos1)+'px');
                    }
                }
            }
        });
        $('#pg'+pgCid).on('mouseup', function(e) {
            $(window).unbind("mousemove");
            if (pos1!=0) {
                if ((e.pageX-pos1)<-50) {
                        if (pgCid<4) {
                            pgCid++;
                            $('#pg'+pgCid).animate({"left":"0"},500,'linear',function() {
                                $('#pg'+pgCid).css({'z-index':1,'box-shadow':'none'});
                                $('#pg'+(pgCid-1)).css("left","-100%");
                                $('#m1 #ml'+(pgCid-1)).removeClass("msel");
                                $('#m1 #ml'+pgCid).addClass("msel");
                            });
                        } else { // retour
                            $('#pg'+pgCid).animate({"left":"0%"},500,'linear');
                        }
                } else if ((e.pageX-pos1)<0) {
                    $('#pg'+pgCid).css('left','0%');
                    if (pgCid<4) {
                        $('#pg'+(pgCid+1)).css({'left':'100%','z-index':1,'box-shadow':'none'});
                    }
                } else if ((e.pageX-pos1)>50) {
                        if (pgCid>1) {
                           pgCid--; 
                           $('#pg'+pgCid).animate({"left":"0"},500,'linear',function(){
                                $('#pg'+pgCid).css({'z-index':1,'box-shadow':'none'});
                                $('#pg'+(pgCid+1)).css("left","100%");
                                $('#m1 #ml'+(pgCid+1)).removeClass("msel");
                                $('#m1 #ml'+pgCid).addClass("msel");
                               }
                           );
                           
                        } else { // retour
                            $('#pg'+pgCid).animate({"left":"0%"},500,'linear');
                        }
                } else if ((e.pageX-pos1)>0) {
                    $('#pg'+pgCid).css('left','0%');
                    if (pgCid>1) {
                        $('#pg'+(pgCid-1)).css({'left':'-100%','z-index':1,'box-shadow':'none'});
                    }
                }
            }
            pos1=0;
        });
    });

var tx1='';
for (i=0; i<=50; i++) {
    tx1+='<li>element '+i+'</li>';
}
$('#ul1').html(tx1);

var myScroll;
var myScroll2;
var position;

function updatePosition () {

}

function loaded () {
	position = document.getElementById('position');

    myScroll = new IScroll('#wrapper', { probeType: 3, mouseWheel: true });
	myScroll.on('scroll', updatePosition);
	myScroll.on('scrollEnd', updatePosition);
    myScroll2 = new IScroll('#wrapper2');
}
loaded();

</script>
